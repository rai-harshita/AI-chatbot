class RestaurantChatbot {
    constructor() {
        this.currentLanguage = 'en';
        this.chatMessages = document.getElementById('chatMessages');
        this.messageInput = document.getElementById('messageInput');
        this.sendButton = document.getElementById('sendButton');
        this.languageSelect = document.getElementById('languageSelect');
        this.reservations = this.loadReservations();
        this.orders = this.loadOrders();
        this.currentCustomerName = null;
        this.waitingForName = false;
        this.pendingAction = null;
        
        this.menu = {
            pizza: { name: 'Pizza', price: 12, available: true, veg: true, popular: true, halal: true },
            burger: { name: 'Burger', price: 8, available: true, veg: false, popular: true, halal: false },
            pasta: { name: 'Pasta', price: 10, available: true, veg: true, glutenFree: false, halal: true },
            coke: { name: 'Coke', price: 3, available: true, veg: true, vegan: true, halal: true },
            salad: { name: 'Salad', price: 6, available: true, veg: true, vegan: true, glutenFree: true, halal: true },
            vegBurger: { name: 'Veg Burger', price: 9, available: true, veg: true, vegan: true, halal: true },
            glutenFreePasta: { name: 'Gluten-Free Pasta', price: 12, available: true, veg: true, glutenFree: true, halal: true },
            garlicBread: { name: 'Garlic Bread', price: 4, available: true, veg: true, halal: true }
        };
        
        this.offers = {
            en: "ЁЯНФ Buy 1 Get 1 Free on Burgers today! ЁЯОЙ 20% off on Pizza orders above $20!",
            hi: "ЁЯНФ рдЖрдЬ рдмрд░реНрдЧрд░ рдкрд░ рдЦрд░реАрджреЗрдВ 1 рдкрд╛рдПрдВ 1 рдореБрдлреНрдд! ЁЯОЙ $20 рд╕реЗ рдКрдкрд░ рдкрд┐рдЬрд╝реНрдЬрд╝рд╛ рдСрд░реНрдбрд░ рдкрд░ 20% рдЫреВрдЯ!",
            es: "ЁЯНФ ┬бCompra 1 y ll├йvate 1 gratis en hamburguesas hoy! ЁЯОЙ ┬б20% de descuento en pedidos de pizza superiores a $20!",
            fr: "ЁЯНФ Achetez 1, obtenez 1 gratuit sur les burgers aujourd'hui! ЁЯОЙ 20% de r├йduction sur les commandes de pizza sup├йrieures ├а 20$!",
            de: "ЁЯНФ Kaufe 1, bekomme 1 gratis bei Burgern heute! ЁЯОЙ 20% Rabatt auf Pizza-Bestellungen ├╝ber $20!"
        };
        
        this.loyaltyPoints = this.loadLoyaltyPoints();
        this.lastOrder = null;
        
        this.orderStatuses = ['confirmed', 'preparing', 'ready', 'delivered'];
        this.customerFeedback = [];
        
        this.responses = {
            en: {
                welcome: "Welcome! I can help with menu, reservations, orders, dietary preferences, recommendations, and feedback. What would you like?",
                menu: "Our menu: Pizza ($12), Burger ($8), Pasta ($10), Coke ($3), Salad ($6). All items available!",
                hours: "We're open Monday-Sunday: 11:00 AM - 10:00 PM. Kitchen closes at 9:30 PM.",
                location: "We're at 123 Main Street, Downtown. Phone: (555) 123-4567. Free parking available.",
                reservation_success: "тЬЕ Table reserved successfully!",
                order_success: "тЬЕ Order placed successfully!",
                ask_name: "May I know your name, please?",
                offers: "ЁЯНФ Buy 1 Get 1 Free on Burgers today! ЁЯОЙ 20% off on Pizza orders above $20!",
                delivery: "Yes, we deliver within 5km radius. Delivery charge: $3. Free delivery on orders above $25.",
                parking: "Free parking available behind the building. Valet service available on weekends.",
                payment: "We accept Card, UPI, Cash, and Digital Wallets. Choose your payment method.",
                cancel_success: "тЬЕ Cancelled successfully!",
                track_order: "Your order is being prepared. Estimated time: 20 minutes. ЁЯСитАНЁЯН│",
                feedback_request: "How was your experience today? Please rate us 1-5 тнР",
                loyalty_earned: "You've earned 10 loyalty points! ЁЯОЙ Total points: ",
                halal: "ЁЯХМ Halal options: Pizza, Pasta, Salad, Veg Burger, Coke, Garlic Bread. All certified halal!",
                recommendations: "ЁЯМЯ Popular dishes: Pizza & Burger! Chef's special: Gluten-Free Pasta with herbs.",
                vegetarian: "ЁЯеЧ Vegetarian options: Pizza, Pasta, Salad, Veg Burger, Coke. All fresh and delicious!",
                vegan: "ЁЯМ▒ Vegan options: Salad, Veg Burger, Coke. Made with plant-based ingredients!",
                glutenFree: "ЁЯМ╛ Gluten-free options: Salad, Gluten-Free Pasta. Safe for celiac customers!",
                escalation: "I understand your frustration. Let me connect you with our manager. Please hold on...",
                feedback_thanks: "Thank you for your feedback! We appreciate your review and will use it to improve.",
                default: "I can help with menu, reservations, orders, dietary needs, recommendations, and feedback. What do you need?"
            },
            hi: {
                welcome: "рд╕реНрд╡рд╛рдЧрдд рд╣реИ! рдореИрдВ рдореЗрдиреНрдпреВ, рдмреБрдХрд┐рдВрдЧ, рдСрд░реНрдбрд░, рдЖрд╣рд╛рд░ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ, рд╕реБрдЭрд╛рд╡ рдФрд░ рдлреАрдбрдмреИрдХ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред",
                menu: "рд╣рдорд╛рд░рд╛ рдореЗрдиреНрдпреВ: рдкрд┐рдЬрд╝реНрдЬрд╝рд╛ (тВ╣300), рдмрд░реНрдЧрд░ (тВ╣200), рдкрд╛рд╕реНрддрд╛ (тВ╣250), рдХреЛрдХ (тВ╣80), рд╕рд▓рд╛рдж (тВ╣150)ред рд╕рднреА рдЙрдкрд▓рдмреНрдз рд╣реИрдВ!",
                hours: "рд╣рдо рд╕реЛрдорд╡рд╛рд░-рд░рд╡рд┐рд╡рд╛рд░: рд╕реБрдмрд╣ 11:00 - рд░рд╛рдд 10:00 рдмрдЬреЗ рддрдХ рдЦреБрд▓реЗ рд╣реИрдВред рд░рд╕реЛрдИ 9:30 рдмрдЬреЗ рдмрдВрдж рд╣реЛ рдЬрд╛рддреА рд╣реИред",
                location: "рд╣рдо 123 рдореЗрди рд╕реНрдЯреНрд░реАрдЯ, рдбрд╛рдЙрдирдЯрд╛рдЙрди рдореЗрдВ рд╣реИрдВред рдлреЛрди: (555) 123-4567ред рдореБрдлреНрдд рдкрд╛рд░реНрдХрд┐рдВрдЧ рдЙрдкрд▓рдмреНрдзред",
                reservation_success: "тЬЕ рдЯреЗрдмрд▓ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдмреБрдХ рд╣реЛ рдЧрдИ!",
                order_success: "тЬЕ рдСрд░реНрдбрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рджрд┐рдпрд╛ рдЧрдпрд╛!",
                ask_name: "рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдирд╛рдо рдмрддрд╛рдПрдВ?",
                offers: "ЁЯНФ рдЖрдЬ рдмрд░реНрдЧрд░ рдкрд░ рдЦрд░реАрджреЗрдВ 1 рдкрд╛рдПрдВ 1 рдореБрдлреНрдд! ЁЯОЙ $20 рд╕реЗ рдКрдкрд░ рдкрд┐рдЬрд╝реНрдЬрд╝рд╛ рдСрд░реНрдбрд░ рдкрд░ 20% рдЫреВрдЯ!",
                delivery: "рд╣рд╛рдБ, рд╣рдо 5 рдХрд┐рдореА рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ рдбрд┐рд▓реАрд╡рд░реА рдХрд░рддреЗ рд╣реИрдВред рдбрд┐рд▓реАрд╡рд░реА рдЪрд╛рд░реНрдЬ: $3ред $25 рд╕реЗ рдКрдкрд░ рдореБрдлреНрдд рдбрд┐рд▓реАрд╡рд░реАред",
                parking: "рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдХреЗ рдкреАрдЫреЗ рдореБрдлреНрдд рдкрд╛рд░реНрдХрд┐рдВрдЧ рдЙрдкрд▓рдмреНрдзред рд╡реАрдХреЗрдВрдб рдкрд░ рд╡реИрд▓реЗрдЯ рд╕реЗрд╡рд╛ рдЙрдкрд▓рдмреНрдзред",
                payment: "рд╣рдо рдХрд╛рд░реНрдб, UPI, рдХреИрд╢ рдФрд░ рдбрд┐рдЬрд┐рдЯрд▓ рд╡реЙрд▓реЗрдЯ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред рдЕрдкрдирд╛ рдкреЗрдореЗрдВрдЯ рдореЗрдердб рдЪреБрдиреЗрдВред",
                cancel_success: "тЬЕ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛!",
                track_order: "рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рддреИрдпрд╛рд░ рд╣реЛ рд░рд╣рд╛ рд╣реИред рдЕрдиреБрдорд╛рдирд┐рдд рд╕рдордп: 20 рдорд┐рдирдЯред ЁЯСитАНЁЯН│",
                feedback_request: "рдЖрдЬ рдЖрдкрдХрд╛ рдЕрдиреБрднрд╡ рдХреИрд╕рд╛ рд░рд╣рд╛? рдХреГрдкрдпрд╛ рд╣рдореЗрдВ 1-5 тнР рд░реЗрдЯрд┐рдВрдЧ рджреЗрдВред",
                loyalty_earned: "рдЖрдкрдиреЗ 10 рд▓реЙрдпрд▓реНрдЯреА рдкреЙрдЗрдВрдЯреНрд╕ рдХрдорд╛рдП рд╣реИрдВ! ЁЯОЙ рдХреБрд▓ рдкреЙрдЗрдВрдЯреНрд╕: ",
                halal: "ЁЯХМ рд╣рд▓рд╛рд▓ рд╡рд┐рдХрд▓реНрдк: рдкрд┐рдЬрд╝реНрдЬрд╝рд╛, рдкрд╛рд╕реНрддрд╛, рд╕рд▓рд╛рдж, рд╡реЗрдЬ рдмрд░реНрдЧрд░, рдХреЛрдХ, рдЧрд╛рд░реНрд▓рд┐рдХ рдмреНрд░реЗрдбред рд╕рднреА рдкреНрд░рдорд╛рдгрд┐рдд рд╣рд▓рд╛рд▓!",
                recommendations: "ЁЯМЯ рд▓реЛрдХрдкреНрд░рд┐рдп рд╡реНрдпрдВрдЬрди: рдкрд┐рдЬрд╝реНрдЬрд╝рд╛ рдФрд░ рдмрд░реНрдЧрд░! рд╢реЗрдл рд╕реНрдкреЗрд╢рд▓: рдЧреНрд▓реВрдЯрди-рдлреНрд░реА рдкрд╛рд╕реНрддрд╛ред",
                vegetarian: "ЁЯеЧ рд╢рд╛рдХрд╛рд╣рд╛рд░реА рд╡рд┐рдХрд▓реНрдк: рдкрд┐рдЬрд╝реНрдЬрд╝рд╛, рдкрд╛рд╕реНрддрд╛, рд╕рд▓рд╛рдж, рд╡реЗрдЬ рдмрд░реНрдЧрд░, рдХреЛрдХред рд╕рднреА рддрд╛рдЬрд╝рд╛!",
                vegan: "ЁЯМ▒ рд╡реАрдЧрди рд╡рд┐рдХрд▓реНрдк: рд╕рд▓рд╛рдж, рд╡реЗрдЬ рдмрд░реНрдЧрд░, рдХреЛрдХред рдкреВрд░реНрдгрддрдГ рдкреМрдзреЗ рдЖрдзрд╛рд░рд┐рдд!",
                glutenFree: "ЁЯМ╛ рдЧреНрд▓реВрдЯрди-рдлреНрд░реА рд╡рд┐рдХрд▓реНрдк: рд╕рд▓рд╛рдж, рдЧреНрд▓реВрдЯрди-рдлреНрд░реА рдкрд╛рд╕реНрддрд╛ред рд╕реБрд░рдХреНрд╖рд┐рдд!",
                escalation: "рдореИрдВ рдЖрдкрдХреА рдкрд░реЗрд╢рд╛рдиреА рд╕рдордЭрддрд╛ рд╣реВрдВред рдореИрдВ рдЖрдкрдХреЛ рд╣рдорд╛рд░реЗ рдореИрдиреЗрдЬрд░ рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реВрдВред",
                feedback_thanks: "рдЖрдкрдХреЗ рдлреАрдбрдмреИрдХ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред",
                default: "рдореИрдВ рдореЗрдиреНрдпреВ, рдмреБрдХрд┐рдВрдЧ, рдСрд░реНрдбрд░, рдЖрд╣рд╛рд░, рд╕реБрдЭрд╛рд╡ рдФрд░ рдлреАрдбрдмреИрдХ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред"
            },
            es: {
                welcome: "┬бBienvenido! Puedo ayudar con men├║, reservas, pedidos, preferencias diet├йticas, recomendaciones y comentarios.",
                menu: "Nuestro men├║: Pizza ($12), Hamburguesa ($8), Pasta ($10), Coca ($3), Ensalada ($6). ┬бTodo disponible!",
                hours: "Abrimos Lunes-Domingo: 11:00 AM - 10:00 PM. La cocina cierra a las 9:30 PM.",
                location: "Estamos en 123 Main Street, Centro. Tel├йfono: (555) 123-4567. Estacionamiento gratuito.",
                reservation_success: "тЬЕ ┬бMesa reservada exitosamente!",
                order_success: "тЬЕ ┬бPedido realizado exitosamente!",
                ask_name: "┬┐Puedo saber su nombre, por favor?",
                offers: "ЁЯНФ ┬бCompra 1 y ll├йvate 1 gratis en hamburguesas hoy! ЁЯОЙ ┬б20% de descuento en pedidos de pizza superiores a $20!",
                delivery: "S├н, entregamos dentro de un radio de 5km. Cargo de entrega: $3. Entrega gratuita en pedidos superiores a $25.",
                parking: "Estacionamiento gratuito disponible detr├бs del edificio. Servicio de valet disponible los fines de semana.",
                payment: "Aceptamos Tarjeta, UPI, Efectivo y Billeteras Digitales. Elija su m├йtodo de pago.",
                cancel_success: "тЬЕ ┬бCancelado exitosamente!",
                track_order: "Su pedido se est├б preparando. Tiempo estimado: 20 minutos. ЁЯСитАНЁЯН│",
                feedback_request: "┬┐C├│mo fue su experiencia hoy? Por favor calif├нquenos 1-5 тнР",
                loyalty_earned: "┬бHas ganado 10 puntos de lealtad! ЁЯОЙ Puntos totales: ",
                halal: "ЁЯХМ Opciones halal: Pizza, Pasta, Ensalada, Hamburguesa Vegetal, Coca, Pan de Ajo. ┬бTodo certificado halal!",
                recommendations: "ЁЯМЯ Platos populares: ┬бPizza y Hamburguesa! Especial del chef: Pasta sin gluten.",
                vegetarian: "ЁЯеЧ Opciones vegetarianas: Pizza, Pasta, Ensalada, Hamburguesa Vegetal, Coca.",
                vegan: "ЁЯМ▒ Opciones veganas: Ensalada, Hamburguesa Vegetal, Coca. ┬бIngredientes vegetales!",
                glutenFree: "ЁЯМ╛ Sin gluten: Ensalada, Pasta sin gluten. ┬бSeguro para cel├нacos!",
                escalation: "Entiendo su frustraci├│n. Le conecto con nuestro gerente. Por favor espere...",
                feedback_thanks: "┬бGracias por sus comentarios! Apreciamos su opini├│n y la usaremos para mejorar.",
                default: "Puedo ayudar con men├║, reservas, pedidos, dieta, recomendaciones y comentarios."
            },
            fr: {
                welcome: "Bienvenue! Je peux aider avec menu, r├йservations, commandes, pr├йf├йrences alimentaires, recommandations et avis.",
                menu: "Notre menu: Pizza (12$), Burger (8$), P├вtes (10$), Coca (3$), Salade (6$). Tout disponible!",
                hours: "Nous sommes ouverts Lundi-Dimanche: 11h00 - 22h00. La cuisine ferme ├а 21h30.",
                location: "Nous sommes au 123 Main Street, Centre-ville. T├йl├йphone: (555) 123-4567. Parking gratuit.",
                reservation_success: "тЬЕ Table r├йserv├йe avec succ├иs!",
                order_success: "тЬЕ Commande pass├йe avec succ├иs!",
                ask_name: "Puis-je conna├оtre votre nom, s'il vous pla├оt?",
                offers: "ЁЯНФ Achetez 1, obtenez 1 gratuit sur les burgers aujourd'hui! ЁЯОЙ 20% de r├йduction sur les commandes de pizza sup├йrieures ├а 20$!",
                delivery: "Oui, nous livrons dans un rayon de 5km. Frais de livraison: 3$. Livraison gratuite sur les commandes sup├йrieures ├а 25$.",
                parking: "Parking gratuit disponible derri├иre le b├вtiment. Service de voiturier disponible le week-end.",
                payment: "Nous acceptons Carte, UPI, Esp├иces et Portefeuilles Num├йriques. Choisissez votre m├йthode de paiement.",
                cancel_success: "тЬЕ Annul├й avec succ├иs!",
                track_order: "Votre commande est en pr├йparation. Temps estim├й: 20 minutes. ЁЯСитАНЁЯН│",
                feedback_request: "Comment ├йtait votre exp├йrience aujourd'hui? Veuillez nous noter 1-5 тнР",
                loyalty_earned: "Vous avez gagn├й 10 points de fid├йlit├й! ЁЯОЙ Points totaux: ",
                halal: "ЁЯХМ Options halal: Pizza, P├вtes, Salade, Burger V├йg├йtal, Coca, Pain ├а l'Ail. Tout certifi├й halal!",
                recommendations: "ЁЯМЯ Plats populaires: Pizza et Burger! Sp├йcial du chef: P├вtes sans gluten.",
                vegetarian: "ЁЯеЧ Options v├йg├йtariennes: Pizza, P├вtes, Salade, Burger V├йg├йtal, Coca.",
                vegan: "ЁЯМ▒ Options v├йganes: Salade, Burger V├йg├йtal, Coca. Ingr├йdients v├йg├йtaux!",
                glutenFree: "ЁЯМ╛ Sans gluten: Salade, P├вtes sans gluten. S├╗r pour les c┼Уliaques!",
                escalation: "Je comprends votre frustration. Je vous connecte avec notre manager.",
                feedback_thanks: "Merci pour vos commentaires! Nous appr├йcions votre avis.",
                default: "Je peux aider avec menu, r├йservations, commandes, r├йgime, recommandations et avis."
            },
            de: {
                welcome: "Willkommen! Ich kann bei Men├╝, Reservierungen, Bestellungen, Ern├дhrungspr├дferenzen, Empfehlungen und Feedback helfen.",
                menu: "Unser Men├╝: Pizza (12$), Burger (8$), Pasta (10$), Cola (3$), Salat (6$). Alles verf├╝gbar!",
                hours: "Wir haben Montag-Sonntag ge├╢ffnet: 11:00 - 22:00 Uhr. Die K├╝che schlie├Яt um 21:30 Uhr.",
                location: "Wir sind in der 123 Main Street, Innenstadt. Telefon: (555) 123-4567. Kostenlose Parkpl├дtze.",
                reservation_success: "тЬЕ Tisch erfolgreich reserviert!",
                order_success: "тЬЕ Bestellung erfolgreich aufgegeben!",
                ask_name: "Darf ich Ihren Namen erfahren, bitte?",
                offers: "ЁЯНФ Kaufe 1, bekomme 1 gratis bei Burgern heute! ЁЯОЙ 20% Rabatt auf Pizza-Bestellungen ├╝ber $20!",
                delivery: "Ja, wir liefern im Umkreis von 5km. Liefergeb├╝hr: $3. Kostenlose Lieferung bei Bestellungen ├╝ber $25.",
                parking: "Kostenlose Parkpl├дtze hinter dem Geb├дude verf├╝gbar. Parkservice am Wochenende verf├╝gbar.",
                payment: "Wir akzeptieren Karte, UPI, Bargeld und Digitale Geldb├╢rsen. W├дhlen Sie Ihre Zahlungsmethode.",
                cancel_success: "тЬЕ Erfolgreich storniert!",
                track_order: "Ihre Bestellung wird zubereitet. Gesch├дtzte Zeit: 20 Minuten. ЁЯСитАНЁЯН│",
                feedback_request: "Wie war Ihre Erfahrung heute? Bitte bewerten Sie uns 1-5 тнР",
                loyalty_earned: "Sie haben 10 Treuepunkte verdient! ЁЯОЙ Gesamtpunkte: ",
                halal: "ЁЯХМ Halal-Optionen: Pizza, Pasta, Salat, Veggie-Burger, Cola, Knoblauchbrot. Alles halal-zertifiziert!",
                recommendations: "ЁЯМЯ Beliebte Gerichte: Pizza und Burger! Chefspezialit├дt: Glutenfreie Pasta.",
                vegetarian: "ЁЯеЧ Vegetarische Optionen: Pizza, Pasta, Salat, Veggie-Burger, Cola.",
                vegan: "ЁЯМ▒ Vegane Optionen: Salat, Veggie-Burger, Cola. Pflanzliche Zutaten!",
                glutenFree: "ЁЯМ╛ Glutenfrei: Salat, Glutenfreie Pasta. Sicher f├╝r Z├╢liakie!",
                escalation: "Ich verstehe Ihre Frustration. Ich verbinde Sie mit unserem Manager.",
                feedback_thanks: "Danke f├╝r Ihr Feedback! Wir sch├дtzen Ihre Meinung.",
                default: "Ich kann bei Men├╝, Reservierungen, Bestellungen, Ern├дhrung, Empfehlungen und Feedback helfen."
            }
        };
        
        this.init();
    }
    
    init() {
        this.sendButton.addEventListener('click', () => this.sendMessage());
        this.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.sendMessage();
        });
        this.languageSelect.addEventListener('change', (e) => {
            this.currentLanguage = e.target.value;
            this.addBotMessage(this.responses[this.currentLanguage].welcome);
        });
        
        // Welcome message
        this.addBotMessage(this.responses[this.currentLanguage].welcome);
    }
    
    sendMessage() {
        const message = this.messageInput.value.trim();
        if (!message) return;
        
        this.addUserMessage(message);
        this.messageInput.value = '';
        
        // Show typing indicator
        this.showTyping();
        
        // Simulate response delay
        setTimeout(() => {
            this.hideTyping();
            const response = this.generateResponse(message);
            this.addBotMessage(response);
        }, 1000);
    }
    
    addUserMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message user-message';
        messageDiv.textContent = message;
        this.chatMessages.appendChild(messageDiv);
        this.scrollToBottom();
    }
    
    addBotMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message bot-message';
        messageDiv.textContent = message;
        this.chatMessages.appendChild(messageDiv);
        this.scrollToBottom();
    }
    
    showTyping() {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message bot-message typing';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
            <span>Typing</span>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        `;
        this.chatMessages.appendChild(typingDiv);
        this.scrollToBottom();
    }
    
    hideTyping() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }
    
    detectLanguage(message) {
        const hindiPattern = /[рдА-ре┐]/;
        const spanishWords = ['hola', 'gracias', 'por favor', 'quiero', 'mesa'];
        const frenchWords = ['bonjour', 'merci', 'voulez', 'table', 'r├йservation'];
        const germanWords = ['hallo', 'danke', 'bitte', 'tisch', 'reservierung'];
        
        if (hindiPattern.test(message)) return 'hi';
        if (spanishWords.some(word => message.toLowerCase().includes(word))) return 'es';
        if (frenchWords.some(word => message.toLowerCase().includes(word))) return 'fr';
        if (germanWords.some(word => message.toLowerCase().includes(word))) return 'de';
        return 'en';
    }
    
    generateResponse(message) {
        // Auto-detect language if not manually set
        const detectedLang = this.detectLanguage(message);
        if (detectedLang !== 'en' && this.currentLanguage === 'en') {
            this.currentLanguage = detectedLang;
            this.languageSelect.value = detectedLang;
        }
        
        const lowerMessage = message.toLowerCase();
        const responses = this.responses[this.currentLanguage];
        
        // Handle name input if waiting for name
        if (this.waitingForName) {
            return this.handleNameInput(message);
        }
        
        // Check for reservations
        if (this.isReservationRequest(message)) {
            return this.handleReservationRequest(message);
        }
        
        // Check for orders
        if (this.isOrderRequest(message)) {
            return this.handleOrderRequest(message);
        }
        
        // Sentiment detection
        if (this.detectNegativeSentiment(message)) {
            return responses.escalation;
        }
        
        // Order tracking
        if (this.isOrderTrackingRequest(message)) {
            return this.handleOrderTracking(message);
        }
        
        // Feedback collection
        if (this.isFeedbackRequest(message)) {
            return this.handleFeedback(message);
        }
        
        // Admin commands
        if (this.isAdminCommand(message)) {
            return this.handleAdminCommand(message);
        }
        
        // Special queries
        if (this.isSpecialQuery(message)) {
            return this.handleSpecialQuery(message);
        }
        
        // Dietary preferences
        if (this.isDietaryRequest(message)) {
            return this.handleDietaryPreferences(message);
        }
        
        // Recommendations
        if (lowerMessage.includes('recommend') || lowerMessage.includes('popular') || lowerMessage.includes('suggest') || lowerMessage.includes('рд╕реБрдЭрд╛рд╡')) {
            return responses.recommendations;
        }
        
        // Menu queries
        if (lowerMessage.includes('menu') || lowerMessage.includes('food') || lowerMessage.includes('рдореЗрдиреНрдпреВ') || lowerMessage.includes('рдкрд┐рдЬрд╝реНрдЬрд╝рд╛')) {
            return responses.menu;
        }
        
        // Hours
        if (lowerMessage.includes('hour') || lowerMessage.includes('open') || lowerMessage.includes('рд╕рдордп')) {
            return responses.hours;
        }
        
        // Location
        if (lowerMessage.includes('location') || lowerMessage.includes('address') || lowerMessage.includes('рдХрд╣рд╛рдВ')) {
            return responses.location;
        }
        
        // Greetings
        if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('рдирдорд╕реНрддреЗ')) {
            return responses.welcome;
        }
        
        return responses.default;
    }
    
    isReservationRequest(message) {
        const reservationKeywords = ['book', 'reserve', 'table', 'рдЯреЗрдмрд▓', 'рдмреБрдХ'];
        return reservationKeywords.some(keyword => message.toLowerCase().includes(keyword));
    }
    
    isOrderRequest(message) {
        const orderKeywords = ['order', 'want', 'buy', 'рдСрд░реНрдбрд░', 'рдЪрд╛рд╣рд┐рдП'];
        const menuItems = Object.keys(this.menu);
        return orderKeywords.some(keyword => message.toLowerCase().includes(keyword)) ||
               menuItems.some(item => message.toLowerCase().includes(item));
    }
    
    handleReservationRequest(message) {
        const nameMatch = message.match(/name\s+is\s+(\w+)|my\s+name\s+is\s+(\w+)|i\s+am\s+(\w+)|рдореЗрд░рд╛\s+рдирд╛рдо\s+(\w+)/i);
        
        if (!nameMatch && !this.currentCustomerName) {
            this.waitingForName = true;
            this.pendingAction = { type: 'reservation', message };
            return this.responses[this.currentLanguage].ask_name;
        }
        
        return this.handleReservation(message);
    }
    
    handleReservation(message) {
        const nameMatch = message.match(/name\s+is\s+(\w+)|my\s+name\s+is\s+(\w+)|i\s+am\s+(\w+)|рдореЗрд░рд╛\s+рдирд╛рдо\s+(\w+)/i);
        const timeMatch = message.match(/(\d{1,2})\s*(pm|am|:рд░рд╛рдд|рд╕реБрдмрд╣)/i);
        const peopleMatch = message.match(/(\d+)\s*(people|person|рд▓реЛрдЧ)/i);
        const dateMatch = message.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})|today|tomorrow|рдЖрдЬ|рдХрд▓/i);
        
        const name = nameMatch ? (nameMatch[1] || nameMatch[2] || nameMatch[3] || nameMatch[4]) : 'Guest';
        const time = timeMatch ? timeMatch[1] + (timeMatch[2].includes('pm') || timeMatch[2].includes('рд░рд╛рдд') ? ' PM' : ' AM') : '7 PM';
        const people = peopleMatch ? peopleMatch[1] : '2';
        const date = dateMatch ? (dateMatch[0].includes('/') ? dateMatch[0] : new Date().toLocaleDateString()) : new Date().toLocaleDateString();
        
        const reservation = { name, people, date, time, id: Date.now() };
        this.reservations.push(reservation);
        this.saveReservations();
        
        const responses = this.responses[this.currentLanguage];
        return `${responses.reservation_success} ${name}, table for ${people} on ${date} at ${time}.`;
    }
    
    handleOrderRequest(message) {
        const nameMatch = message.match(/name\s+is\s+(\w+)|my\s+name\s+is\s+(\w+)|i\s+am\s+(\w+)|рдореЗрд░рд╛\s+рдирд╛рдо\s+(\w+)/i);
        
        if (!nameMatch && !this.currentCustomerName) {
            this.waitingForName = true;
            this.pendingAction = { type: 'order', message };
            return this.responses[this.currentLanguage].ask_name;
        }
        
        return this.handleOrder(message);
    }
    
    handleOrder(message) {
        const nameMatch = message.match(/name\s+is\s+(\w+)|my\s+name\s+is\s+(\w+)|i\s+am\s+(\w+)|рдореЗрд░рд╛\s+рдирд╛рдо\s+(\w+)/i);
        const customerName = nameMatch ? (nameMatch[1] || nameMatch[2] || nameMatch[3] || nameMatch[4]) : (this.currentCustomerName || 'Guest');
        
        const orderItems = [];
        let total = 0;
        
        Object.keys(this.menu).forEach(item => {
            const regex = new RegExp(`(\\d+)\\s*${item}`, 'i');
            const match = message.match(regex);
            if (match || message.toLowerCase().includes(item)) {
                const quantity = match ? parseInt(match[1]) : 1;
                orderItems.push(`${quantity} ${this.menu[item].name}`);
                total += quantity * this.menu[item].price;
            }
        });
        
        if (orderItems.length > 0) {
            const order = { customerName, items: orderItems, total, date: new Date().toLocaleDateString(), time: new Date().toLocaleTimeString(), id: Date.now() };
            this.orders.push(order);
            this.lastOrder = order;
            this.saveOrders();
            this.updateLoyaltyPoints(customerName, Math.floor(total));
            
            const responses = this.responses[this.currentLanguage];
            let response = `${responses.order_success} ${customerName}, ${orderItems.join(', ')}. Total: $${total}`;
            
            // Add personalized recommendations
            if (orderItems.some(item => item.includes('Pizza'))) {
                response += ` Would you like to add Coke or Garlic Bread with your pizza? ЁЯНХЁЯед`;
            }
            
            return response;
        }
        
        return this.responses[this.currentLanguage].menu;
    }
    
    detectNegativeSentiment(message) {
        const negativeWords = ['angry', 'frustrated', 'terrible', 'awful', 'worst', 'hate', 'disgusting', 'рдЧреБрд╕реНрд╕рд╛', 'рдмреБрд░рд╛', 'рдЦрд░рд╛рдм'];
        return negativeWords.some(word => message.toLowerCase().includes(word));
    }
    
    isOrderTrackingRequest(message) {
        const trackingKeywords = ['track', 'status', 'where', 'ready', 'рд╕реНрдерд┐рддрд┐', 'рдХрд╣рд╛рдВ'];
        return trackingKeywords.some(keyword => message.toLowerCase().includes(keyword)) && 
               (message.toLowerCase().includes('order') || message.toLowerCase().includes('рдСрд░реНрдбрд░'));
    }
    
    handleOrderTracking(message) {
        if (this.orders.length === 0) {
            return "No active orders found. Please place an order first.";
        }
        
        const lastOrder = this.orders[this.orders.length - 1];
        const randomStatus = this.orderStatuses[Math.floor(Math.random() * this.orderStatuses.length)];
        
        const statusMessages = {
            en: {
                confirmed: "ЁЯУЛ Your order is confirmed and being processed.",
                preparing: "ЁЯСитАНЁЯН│ Your order is being prepared in the kitchen.",
                ready: "тЬЕ Your order is ready for pickup/delivery!",
                delivered: "ЁЯЪЪ Your order has been delivered. Enjoy your meal!"
            },
            hi: {
                confirmed: "ЁЯУЛ рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рдХрдиреНрдлрд░реНрдо рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕ рд╣реЛ рд░рд╣рд╛ рд╣реИред",
                preparing: "ЁЯСитАНЁЯН│ рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рд░рд╕реЛрдИ рдореЗрдВ рддреИрдпрд╛рд░ рд╣реЛ рд░рд╣рд╛ рд╣реИред",
                ready: "тЬЕ рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рддреИрдпрд╛рд░ рд╣реИ!",
                delivered: "ЁЯЪЪ рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рдбрд┐рд▓реАрд╡рд░ рд╣реЛ рдЧрдпрд╛ рд╣реИред рдЦрд╛рдирд╛ рдПрдиреНрдЬреЙрдп рдХрд░реЗрдВ!"
            }
        };
        
        const lang = this.currentLanguage === 'hi' ? 'hi' : 'en';
        return statusMessages[lang][randomStatus] || statusMessages.en[randomStatus];
    }
    
    isFeedbackRequest(message) {
        const feedbackKeywords = ['feedback', 'review', 'rating', 'experience', 'service', 'рдлреАрдбрдмреИрдХ', 'рд╕рдореАрдХреНрд╖рд╛'];
        return feedbackKeywords.some(keyword => message.toLowerCase().includes(keyword));
    }
    
    handleFeedback(message) {
        this.customerFeedback.push({
            message: message,
            timestamp: new Date().toISOString(),
            language: this.currentLanguage
        });
        
        return this.responses[this.currentLanguage].feedback_thanks;
    }
    
    isDietaryRequest(message) {
        const dietaryKeywords = ['vegetarian', 'vegan', 'gluten', 'dairy', 'рд╢рд╛рдХрд╛рд╣рд╛рд░реА', 'рд╡реАрдЧрди', 'рдЧреНрд▓реВрдЯрди'];
        return dietaryKeywords.some(keyword => message.toLowerCase().includes(keyword));
    }
    
    handleDietaryPreferences(message) {
        const responses = this.responses[this.currentLanguage];
        const lowerMessage = message.toLowerCase();
        
        if (lowerMessage.includes('vegetarian') || lowerMessage.includes('рд╢рд╛рдХрд╛рд╣рд╛рд░реА')) {
            return responses.vegetarian;
        } else if (lowerMessage.includes('vegan') || lowerMessage.includes('рд╡реАрдЧрди')) {
            return responses.vegan;
        } else if (lowerMessage.includes('gluten') || lowerMessage.includes('рдЧреНрд▓реВрдЯрди')) {
            return responses.glutenFree;
        } else if (lowerMessage.includes('halal') || lowerMessage.includes('рд╣рд▓рд╛рд▓')) {
            return responses.halal;
        }
        
        return responses.menu;
    }
    
    loadReservations() {
        try {
            const saved = localStorage.getItem('restaurantReservations');
            return saved ? JSON.parse(saved) : [];
        } catch {
            return [];
        }
    }
    
    saveReservations() {
        try {
            localStorage.setItem('restaurantReservations', JSON.stringify(this.reservations));
            this.downloadFile('reservations.txt', this.formatReservationsForFile());
        } catch (e) {
            console.error('Error saving reservations:', e);
        }
    }
    
    loadOrders() {
        try {
            const saved = localStorage.getItem('restaurantOrders');
            return saved ? JSON.parse(saved) : [];
        } catch {
            return [];
        }
    }
    
    saveOrders() {
        try {
            localStorage.setItem('restaurantOrders', JSON.stringify(this.orders));
            this.downloadFile('orders.txt', this.formatOrdersForFile());
        } catch (e) {
            console.error('Error saving orders:', e);
        }
    }
    
    formatReservationsForFile() {
        let content = 'RESTAURANT RESERVATIONS\n';
        content += '========================\n\n';
        this.reservations.forEach(res => {
            content += `Name: ${res.name}\n`;
            content += `People: ${res.people}\n`;
            content += `Date: ${res.date}\n`;
            content += `Time: ${res.time}\n`;
            content += `ID: ${res.id}\n`;
            content += '-------------------\n';
        });
        return content;
    }
    
    formatOrdersForFile() {
        let content = 'RESTAURANT ORDERS\n';
        content += '=================\n\n';
        this.orders.forEach(order => {
            content += `Customer: ${order.customerName}\n`;
            content += `Items: ${order.items.join(', ')}\n`;
            content += `Total: $${order.total}\n`;
            content += `Date: ${order.date}\n`;
            content += `Time: ${order.time}\n`;
            content += `ID: ${order.id}\n`;
            content += '-------------------\n';
        });
        return content;
    }
    
    downloadFile(filename, content) {
        const blob = new Blob([content], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
    }
    
    handleNameInput(message) {
        // Extract name from the message
        const nameMatch = message.match(/^([a-zA-Z\s]+)$/) || message.match(/name\s+is\s+(\w+)|my\s+name\s+is\s+(\w+)|i\s+am\s+(\w+)|рдореЗрд░рд╛\s+рдирд╛рдо\s+(\w+)/i);
        
        if (nameMatch) {
            this.currentCustomerName = nameMatch[1] || nameMatch[2] || nameMatch[3] || nameMatch[4] || message.trim();
            this.waitingForName = false;
            
            // Process the pending action
            if (this.pendingAction) {
                const result = this.pendingAction.type === 'reservation' 
                    ? this.handleReservation(this.pendingAction.message)
                    : this.handleOrder(this.pendingAction.message);
                this.pendingAction = null;
                return result;
            }
        }
        
        return this.responses[this.currentLanguage].ask_name;
    }
    
    isAdminCommand(message) {
        const adminKeywords = ['show reservations', 'show orders', 'cancel', 'daily report'];
        return adminKeywords.some(keyword => message.toLowerCase().includes(keyword));
    }
    
    handleAdminCommand(message) {
        const lowerMessage = message.toLowerCase();
        
        if (lowerMessage.includes('show reservations')) {
            if (this.reservations.length === 0) return 'No reservations found.';
            let result = 'Current Reservations:\n';
            this.reservations.forEach((res, i) => {
                result += `${i+1}. ${res.name} reserved table for ${res.people} on ${res.date} at ${res.time}\n`;
            });
            return result;
        }
        
        if (lowerMessage.includes('show orders')) {
            if (this.orders.length === 0) return 'No orders found.';
            let result = 'Current Orders:\n';
            this.orders.forEach((order, i) => {
                result += `${i+1}. ${order.customerName}: ${order.items.join(', ')} - $${order.total}\n`;
            });
            return result;
        }
        
        if (lowerMessage.includes('cancel')) {
            const nameMatch = message.match(/cancel\s+(\w+)/i);
            if (nameMatch) {
                const name = nameMatch[1];
                this.reservations = this.reservations.filter(res => res.name.toLowerCase() !== name.toLowerCase());
                this.orders = this.orders.filter(order => order.customerName.toLowerCase() !== name.toLowerCase());
                this.saveReservations();
                this.saveOrders();
                return this.responses[this.currentLanguage].cancel_success;
            }
        }
        
        if (lowerMessage.includes('daily report')) {
            return `Daily Report:\nReservations: ${this.reservations.length}\nOrders: ${this.orders.length}\nTotal Revenue: $${this.orders.reduce((sum, order) => sum + order.total, 0)}`;
        }
        
        return this.responses[this.currentLanguage].default;
    }
    
    isSpecialQuery(message) {
        const specialKeywords = ['offer', 'deal', 'discount', 'deliver', 'parking', 'payment', 'track', 'feedback', 'rate'];
        return specialKeywords.some(keyword => message.toLowerCase().includes(keyword));
    }
    
    handleSpecialQuery(message) {
        const lowerMessage = message.toLowerCase();
        const responses = this.responses[this.currentLanguage];
        
        if (lowerMessage.includes('offer') || lowerMessage.includes('deal') || lowerMessage.includes('discount')) {
            return responses.offers;
        }
        
        if (lowerMessage.includes('deliver')) {
            return responses.delivery;
        }
        
        if (lowerMessage.includes('parking')) {
            return responses.parking;
        }
        
        if (lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
            return responses.payment;
        }
        
        if (lowerMessage.includes('track')) {
            return responses.track_order;
        }
        
        if (lowerMessage.includes('feedback') || lowerMessage.includes('rate')) {
            return responses.feedback_request;
        }
        
        return responses.default;
    }
    
    loadLoyaltyPoints() {
        try {
            const saved = localStorage.getItem('loyaltyPoints');
            return saved ? JSON.parse(saved) : {};
        } catch {
            return {};
        }
    }
    
    updateLoyaltyPoints(customerName, points) {
        if (!this.loyaltyPoints[customerName]) {
            this.loyaltyPoints[customerName] = 0;
        }
        this.loyaltyPoints[customerName] += points;
        localStorage.setItem('loyaltyPoints', JSON.stringify(this.loyaltyPoints));
    }
    
    scrollToBottom() {
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
    }
}

// Function to start chat (hide cover page and show chatbot)
function startChat() {
    document.getElementById('coverPage').style.display = 'none';
    document.getElementById('chatContainer').style.display = 'flex';
    // Initialize chatbot after showing the container
    new RestaurantChatbot();
}

// Initialize the page when loaded
document.addEventListener('DOMContentLoaded', () => {
    // Cover page is shown by default, chatbot initializes when user clicks start
});